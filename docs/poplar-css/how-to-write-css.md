# 我们应该怎样编写样式

## 选择器的选择

如果追求的是编码速度，那么标签选择器毫无疑问将是最佳的选择。

没有类选择器的命名烦恼，如果结合 `Less`/`Sass` 的嵌套特性，还可以免除重复书写选择器的麻烦，敲起键盘来可以不假思索，编码过程非常流畅。

但是也有明显的缺点，就是日常的维护非常麻烦，只适合于一锤子的买卖——写完就不用再管的那种。除非可以通过开发者工具直接定位到具体文件的具体行，否则我一条声明都不想改，偏偏在工作中还经常遇到这种一锤子写法。

如果从性能的角度来说的话，对于选择器就只有一个要求：直接。

而能做到直接的，就只有四种选择器：通配、标签、`ID` 和类，其他的关系、属性、伪类和伪对象选择器，都是依赖于前者的，也就谈不上直接了。

简单总结一下这四种选择器的特点：通配和标签类似，可以匹配多个元素，但没有指定元素的能力；`ID`，只能指定元素，而没有匹配多个元素的能力；类，既可以匹配多个元素，又能够指定元素。这就是类选择器被推崇的原因所在。

## `BEM` 命名规范

既然选用了类选择器，自然就无法绕开命名的问题，以及必然衍生的重名的问题。`BEM` 正是为了解决这些问题而存在。

`BEM` 代表的是 `Block`（块）、`Element`（元素）和 `Modifier`（修饰符），通用的命名规则是：`block__element--modifier`。

请看一个简单的例子：

``` css
/* 传统编写习惯 */
.menu li { /* 声明 */ }

/* BEM 规范 */
.menu__item { /* 声明 */ }
```

相对来说，使用 `BEM`，就意味着 `HTML` 需要承担更多。传统写法，`li` 元素并不需要指定 `class`，而使用 `BEM` 却是需要的，`HTML` 文件难免臃肿。

优异之处在于：`BEM` 精简了选择器层级，也就是前面所说的性能角度的“直接”。只需要通过 `.menu__item` 就能找到匹配的 `CSS` 规则，一步到位，而不需要在匹配 `li` 之后还要向上查找是否存在 `.menu`。

但同时也有一个不可避免的问题：`BEM` 的命名，真的会很长！

## `CSS` 模块化

使用 `Webpack` 构建应用时，可以为 `CSS` 开启模块化功能。模块化，可以认为是 `BEM` 规范的自动强化版。

无论是 `React` 还是 `Vue`，它们的官方脚手架都配置支持此项功能。当然，`Vue` 还有局部样式的用法，本质上就是增加了一层属性选择器，从性能角度来说，稍逊一筹了。

以 `BEM` 的命名风格来划分的话，在模块化中，`B` 对应了文件名，`E` 对应了选择器名称，`M` 则是使用文件路径、文件名和选择器名称计算得到的一个哈希值（大概是这样）。也就是说，我们真正用到的只有 `E`，没有其他的约束，一个 `-` 就可以打天下，名字都仿佛变短了。

同样一个简单的例子：

``` css
/* 传统编写习惯 */
.menu li { /* 声明 */ }

/* BEM 规范 */
.menu__item { /* 声明 */ }

/**
 * CSS 模块化
 * menu.module.css
 */
.item { /* 声明 */ }
```

## `CSS` 规则是怎样匹配的

首先说结论，`CSS` 规则的匹配顺序是从右到左的。

因为 `CSS` 规则不管多么复杂，都会有一个明确的目标，那就是它的最右选择器。从右到左匹配之所以更加高效，就是因为它在匹配之初已经把目标群体给锁定了。

浏览器渲染页面前，需要先构建两棵树：`DOM` 和 `CSSOM`，然后将二者合并而成渲染树。

为了构建渲染树，浏览器从 `DOM` 树的根节点开始遍历每个节点。如果是不可见节点（如 `script`、`meta` 等），将会被忽略；否则将会找到它匹配的 `CSSOM` 规则并应用，如果节点通过 `CSS` 隐藏一样会被忽略。

假设现在有 `CSS` 规则如下：

``` css
li {}
.menu li {}
.menu__item {}
```

经过浏览器的解析，它们将会被分成两组：

``` css
/* 1) li */
li {}
.menu li {}

/* 2) .menu__item */
.menu__item {}
```

当浏览器遍历到 `li` 节点时，它立刻就知道应该在第一组中寻找匹配的规则。选择器是 `li` 的规则得到匹配，然后沿着父元素向上搜寻 `.menu`，若存在则表示 `.menu li` 规则匹配，若不存在则结束匹配流程。

浏览器继续遍历，遇到一个类名为 `menu__item` 的节点，它知道所有可能匹配的规则都在第二组中，于是进入并匹配成功。

对比以上两个匹配过程，你就知道为什么要用类选择器，为什么不用标签选择器，这就是“直接”的优势。

规则匹配应该、大概就是这么个样子。

## 结语

`BEM` 是好东西，能上还是要上，标签选择器该弃就弃，当然，这是基于良好的编码习惯的角度所作出的建议，从大部分页面的元素数量级的角度来说，编写样式的方式对性能的影响基本可以忽略。
